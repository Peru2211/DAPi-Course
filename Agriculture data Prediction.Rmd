---
title: "Agriculture Data Predictions"
author: "GSGill"
date: "`r Sys.Date()`"
output: html_document
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
crop_data <- read.csv("D:/(A) Gauravjit/NYU MASTERS COURSE/OneDrive - nyu.edu/SEM 2/Data Analytics/PROJECT 3/India Agriculture Crop Production.csv")
crop_data[crop_data==""]=NA
sum(is.na(crop_data))

summary(crop_data)
str(crop_data)
hist(crop_data$Production)

crop_data <- na.omit(crop_data) # remove rows with missing values
crop_data$Year <- as.factor(crop_data$Year) # convert Year to a factor variable

#predict the production of a certain crop in a certain state given certain weather and soil conditions.
# Split the dataset into training and testing sets. You can use the caret package to do this:
library(caret)
set.seed(123) # for reproducibility
train_index <- createDataPartition(crop_data$Production, p = 0.8, list = FALSE)
train_data <- crop_data[train_index, ]
test_data <- crop_data[-train_index, ]

#  There are many options, including linear regression, decision trees, random forests, and neural networks. 
names(train_data)

# In this case, we can choose "Production" as the dependent variable and use the other variables as independent variables. Our hypothesis is that the production of crops is affected by various factors such as state, district, crop, year, season, area, and yield.

# Create the linear regression model
model <- lm(Production ~ State + District + Crop + Year + Season + Area + Yield, data = crop_data)

# Print the summary of the model
summary(model)

#Evaluate the model's performance on the testing data. You can use metrics like mean squared error (MSE), mean absolute error (MAE), and R-squared.
predictions <- predict(model, test_data)
mse <- mean((test_data$Production - predictions)^2)
mae <- mean(abs(test_data$Production - predictions))
rsq <- cor(test_data$Production, predictions)^2



# Load necessary libraries
library(ggplot2)
library(dplyr)

# Create a summary of the model
model_summary <- summary(model)

# Extract coefficients and p-values
coef_df <- as.data.frame(model_summary$coefficients) %>%
  mutate(var = rownames(.)) %>%
  select(var, Estimate, `Pr(>|t|)`)

# Create a bar plot of the coefficients
ggplot(coef_df, aes(x = var, y = Estimate)) +
  geom_col() +
  coord_flip() +
  ggtitle("Coefficients of the Linear Regression Model") +
  xlab("") +
  ylab("Estimate")

# Create a histogram of the residuals
ggplot(data.frame(resid = model_summary$residuals), aes(x = resid)) +
  geom_histogram(binwidth = 1e7) +
  ggtitle("Histogram of Residuals") +
  xlab("Residuals") +
  ylab("Count")

# Create a scatter plot of the predicted vs actual values
ggplot(data.frame(pred = predictions, actual = test_data$Production), aes(x = actual, y = pred)) +
  geom_point() +
  geom_abline(slope = 1, intercept = 0, color = "red") +
  ggtitle("Predicted vs Actual Production Values") +
  xlab("Actual Production") +
  ylab("Predicted Production")

# Print the model's performance metrics
cat("Mean squared error:", mse, "\n")
cat("Mean absolute error:", mae, "\n")
cat("R-squared:", rsq, "\n")

```




```{r}
#new approach

# Create a training and testing set
set.seed(123)
trainIndex <- createDataPartition(crop_data$Yield, p = .8, list = FALSE)
trainData <- crop_data[trainIndex,]
testData <- crop_data[-trainIndex,]

# create a new categorical variable based on a threshold value
trainData$YieldCat <- ifelse(trainData$Yield > 2000, "High", "Low")

# fit a linear regression model with the categorical variable
model <- lm(Yield ~ . - YieldCat, data = trainData)
summary(model)


# Build a linear regression model
model <- lm(Yield ~ ., data = trainData)

# Evaluate the model
predictions <- predict(model, newdata = testData)
RMSE <- caret::RMSE(predictions, testData$Yield)
R_squared <- summary(model)$r.squared

# Make predictions on new data
new_data <- data.frame(
  Crop_Year = 2018,
  Area = 200000,
  Production = 400000,
  Rainfall = 1200,
  Temperature = 25
)
prediction <- predict(model, newdata = new_data)

```


```{r}

# Install and load required packages
install.packages("maptools")
install.packages("terra")
library(maptools)
library(terra)

install.packages("sf")
library(sf)
setwd("D:/A Gauravjit/NYU MASTERS COURSE/OneDrive - nyu.edu/SEM 2/Data Analytics/PROJECT 3/")
shapefile <- st_read("india_ds.shp")

# Create terra vector object from shapefile
shapefile <- vect(shapefile)

# Load the shapefile using terra package
shapefile <- vect("india_ds.shp")




```